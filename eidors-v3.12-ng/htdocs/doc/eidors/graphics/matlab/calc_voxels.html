<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of calc_voxels</title>
  <meta name="keywords" content="calc_voxels">
  <meta name="description" content="CALC_VOXELS Calculate volumetric data from an image">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">eidors</a> &gt; <a href="#">graphics</a> &gt; <a href="index.html">matlab</a> &gt; calc_voxels.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for eidors/graphics/matlab&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>calc_voxels
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>CALC_VOXELS Calculate volumetric data from an image</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [V, rimg] = calc_voxels(img, opt, level) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">CALC_VOXELS Calculate volumetric data from an image
 V = CALC_VOXELS(IMG) calculates volumetric representation of the image 
 IMG using a 3D grid with a maximum dimension of 32. V is a 3-D or 4-D
 matrix with dimensions Y x X x Z x N, where N is the number of frames in
 the image data (time), and X, Y, Z refer to the axes of the image node 
 space. 

 V = CALC_VOXELS(IMG, OPT) allows specifying an options struct:
   OPT.method  - specifies the method of determining value in each voxel:
                   'centre'  - the value at its centre (default)
                   'average' - the average value (expensive)
                 The average method can only be used for images with
                 values specified on elements (elem_data). It produces
                 smoother images that simulate the partial volume effect 
                 and look better at lower resolution than the 'centre' 
                 method.
   OPT.imgsz   - specifies the target grid size (default [32 32 32]). 
                 See DEFINE_VOXELS for details, alternatives and 
                 additional options.
                 voxels supported by DEFINE_VOXELS can also be used.
   OPT.save_memory - only useful if method is 'average', reduces memory
                 consumption, at the expense of time. See MK_GRID_C2F.
                 All other options of MK_GRID_C2F may also be specified.
 NOTE: The OPT struct is passed in its entirety to both DEFINE_VOXELS and 
        MK_GRID_C2F. 
                
 V = CALC_VOXELS(IMG, OPT, LEVEL) specifies the orientaion of the XY plane
 of the voxel grid. Any definition of a single slice accepted by
 LEVEL_MODEL_SLICE can be used. OPT can be an empty struct. 

 [V, RIMG] = CALC_VOXELS(_) also returns a grid-based image as produced
 by MK_GRID_MODEL, suitable for use with SHOW_FEM.

 CALC_VOXELS supports parametrization through DATA_MAPPER.

 Example:
  fmdl = ng_mk_ellip_models([1,1.5,0.8,0.1],[],[]);
  fmdl.nodes(:,3) = fmdl.nodes(:,3) - .25;
  fmdl = fix_model(fmdl, struct('elem_centre',true));
  img = mk_image(fmdl, prod(fmdl.elem_centre,2));
  [V, rimg] = calc_voxels(img);
  subplot(221), show_fem(img)
  subplot(222), show_fem(rimg);
  subplot(223), show_slices(rimg,3);
  subplot(224), show_slices(V);

 See also <a href="define_voxels.html" class="code" title="function [xvec, yvec, zvec, opt] = define_voxels(fmdl, varargin)">DEFINE_VOXELS</a>, <a href="calc_grid_points.html" class="code" title="function [val, c2f] = calc_grid_points(img, xpts, ypts, zpts)">CALC_GRID_POINTS</a>, MK_GRID_C2F, MK_GRID_MODEL,
 <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">CALC_SLICES</a>, DATA_MAPPER</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="calc_grid_points.html" class="code" title="function [val, c2f] = calc_grid_points(img, xpts, ypts, zpts)">calc_grid_points</a>	CALC_GRID_POINTS - image values at points in grid</li><li><a href="calc_voxels.html" class="code" title="function [V, rimg] = calc_voxels(img, opt, level)">calc_voxels</a>	CALC_VOXELS Calculate volumetric data from an image</li><li><a href="define_voxels.html" class="code" title="function [xvec, yvec, zvec, opt] = define_voxels(fmdl, varargin)">define_voxels</a>	DEFINE VOXELS define edges of a voxel grid covering a model</li><li><a href="level_model_slice.html" class="code" title="function [out, out2, out3, out4] = level_model_slice(varargin)">level_model_slice</a>	LEVEL_MODEL_SLICE - level 3D points for slicing at z=0</li><li><a href="show_fem.html" class="code" title="function hh=show_fem( mdl, options)">show_fem</a>	SHOW_FEM: show the EIDORS3D finite element model</li><li><a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>	out_img = show_slices (img, levels ) show slices at levels of an</li><li><a href="../../../eidors/meshing/netgen/ng_mk_ellip_models.html" class="code" title="function [fmdl,mat_idx] = ng_mk_ellip_models(ellip_shape, elec_pos,elec_shape, extra_ng_code);">ng_mk_ellip_models</a>	NG_MAKE_ELLIP_MODELS: create elliptical models using netgen</li><li><a href="../../../eidors/models/data_mapper.html" class="code" title="function img = data_mapper(img, reverse)">data_mapper</a>	DATA_MAPPER maps img.params data to elem or node data</li><li><a href="../../../eidors/models/fix_model.html" class="code" title="function [mdl] = fix_model(mdl,opt)">fix_model</a>	FIX_MODEL: Add useful fields to a model</li><li><a href="../../../eidors/models/get_elem_volume.html" class="code" title="function VOL = get_elem_volume( fwd_model, map_node )">get_elem_volume</a>	GET_ELEM_VOLUME: VOL = get_elem_volume(fwd_model, map_node )</li><li><a href="../../../eidors/models/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>	MK_COMMON_MODEL: make common EIT models</li><li><a href="../../../eidors/models/mk_grid_c2f.html" class="code" title="function [c2f, m] = mk_grid_c2f(fmdl, rmdl, opt)">mk_grid_c2f</a>	MK_GRID_C2F - calculate a coarse2fine mapping for grid coarse models.</li><li><a href="../../../eidors/models/mk_grid_model.html" class="code" title="function [cmdl, c2f]= mk_grid_model(fmdl, xvec, yvec, zvec, removefn);">mk_grid_model</a>	MK_GRID_MODEL: Create reconstruction model on pixelated grid</li><li><a href="../../../eidors/models/mk_image.html" class="code" title="function img= mk_image(mdl, elem_data, params, name)">mk_image</a>	MK_IMAGE: create eidors image object</li><li><a href="../../../eidors/models/num_elems.html" class="code" title="function num = num_elems( mdl );">num_elems</a>	NUM_ELEMS: number of elemnts in a (fwd or inv model or image)</li><li><a href="../../../eidors/models/num_nodes.html" class="code" title="function num = num_nodes( mdl );">num_nodes</a>	NUM_NODES: number of elemnts in a (fwd or inv model or image)</li><li><a href="../../../eidors/tools/spdiag.html" class="code" title="function S = spdiag(V,K)">spdiag</a>	SPDIAG Sparse diagonal matrices and diagonals of a matrix.</li><li><a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>	UNIT_TEST_CMP: compare matrices in eidors output</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="calc_voxels.html" class="code" title="function [V, rimg] = calc_voxels(img, opt, level)">calc_voxels</a>	CALC_VOXELS Calculate volumetric data from an image</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function do_unit_test</a></li><li><a href="#_sub2" class="code">function do_cases</a></li><li><a href="#_sub3" class="code">function show_test(img, V, rimg)</a></li><li><a href="#_sub4" class="code">function do_example</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [V, rimg] = calc_voxels(img, opt, level)</a>
0002 <span class="comment">%CALC_VOXELS Calculate volumetric data from an image</span>
0003 <span class="comment">% V = CALC_VOXELS(IMG) calculates volumetric representation of the image</span>
0004 <span class="comment">% IMG using a 3D grid with a maximum dimension of 32. V is a 3-D or 4-D</span>
0005 <span class="comment">% matrix with dimensions Y x X x Z x N, where N is the number of frames in</span>
0006 <span class="comment">% the image data (time), and X, Y, Z refer to the axes of the image node</span>
0007 <span class="comment">% space.</span>
0008 <span class="comment">%</span>
0009 <span class="comment">% V = CALC_VOXELS(IMG, OPT) allows specifying an options struct:</span>
0010 <span class="comment">%   OPT.method  - specifies the method of determining value in each voxel:</span>
0011 <span class="comment">%                   'centre'  - the value at its centre (default)</span>
0012 <span class="comment">%                   'average' - the average value (expensive)</span>
0013 <span class="comment">%                 The average method can only be used for images with</span>
0014 <span class="comment">%                 values specified on elements (elem_data). It produces</span>
0015 <span class="comment">%                 smoother images that simulate the partial volume effect</span>
0016 <span class="comment">%                 and look better at lower resolution than the 'centre'</span>
0017 <span class="comment">%                 method.</span>
0018 <span class="comment">%   OPT.imgsz   - specifies the target grid size (default [32 32 32]).</span>
0019 <span class="comment">%                 See DEFINE_VOXELS for details, alternatives and</span>
0020 <span class="comment">%                 additional options.</span>
0021 <span class="comment">%                 voxels supported by DEFINE_VOXELS can also be used.</span>
0022 <span class="comment">%   OPT.save_memory - only useful if method is 'average', reduces memory</span>
0023 <span class="comment">%                 consumption, at the expense of time. See MK_GRID_C2F.</span>
0024 <span class="comment">%                 All other options of MK_GRID_C2F may also be specified.</span>
0025 <span class="comment">% NOTE: The OPT struct is passed in its entirety to both DEFINE_VOXELS and</span>
0026 <span class="comment">%        MK_GRID_C2F.</span>
0027 <span class="comment">%</span>
0028 <span class="comment">% V = CALC_VOXELS(IMG, OPT, LEVEL) specifies the orientaion of the XY plane</span>
0029 <span class="comment">% of the voxel grid. Any definition of a single slice accepted by</span>
0030 <span class="comment">% LEVEL_MODEL_SLICE can be used. OPT can be an empty struct.</span>
0031 <span class="comment">%</span>
0032 <span class="comment">% [V, RIMG] = CALC_VOXELS(_) also returns a grid-based image as produced</span>
0033 <span class="comment">% by MK_GRID_MODEL, suitable for use with SHOW_FEM.</span>
0034 <span class="comment">%</span>
0035 <span class="comment">% CALC_VOXELS supports parametrization through DATA_MAPPER.</span>
0036 <span class="comment">%</span>
0037 <span class="comment">% Example:</span>
0038 <span class="comment">%  fmdl = ng_mk_ellip_models([1,1.5,0.8,0.1],[],[]);</span>
0039 <span class="comment">%  fmdl.nodes(:,3) = fmdl.nodes(:,3) - .25;</span>
0040 <span class="comment">%  fmdl = fix_model(fmdl, struct('elem_centre',true));</span>
0041 <span class="comment">%  img = mk_image(fmdl, prod(fmdl.elem_centre,2));</span>
0042 <span class="comment">%  [V, rimg] = calc_voxels(img);</span>
0043 <span class="comment">%  subplot(221), show_fem(img)</span>
0044 <span class="comment">%  subplot(222), show_fem(rimg);</span>
0045 <span class="comment">%  subplot(223), show_slices(rimg,3);</span>
0046 <span class="comment">%  subplot(224), show_slices(V);</span>
0047 <span class="comment">%</span>
0048 <span class="comment">% See also DEFINE_VOXELS, CALC_GRID_POINTS, MK_GRID_C2F, MK_GRID_MODEL,</span>
0049 <span class="comment">% CALC_SLICES, DATA_MAPPER</span>
0050 
0051 <span class="comment">% (C) 2024 Bartlomiej Grychtol</span>
0052 <span class="comment">% License: GPL version 2 or 3</span>
0053 <span class="comment">% $Id: calc_voxels.m 7094 2024-12-20 23:05:22Z bgrychtol $</span>
0054 
0055 <span class="keyword">if</span> ischar(img) &amp;&amp; strcmp(img, <span class="string">'UNIT_TEST'</span>), <a href="#_sub1" class="code" title="subfunction do_unit_test">do_unit_test</a>; <span class="keyword">return</span>, <span class="keyword">end</span>
0056 
0057 <span class="keyword">if</span> nargin &lt; 2
0058     opt = struct();
0059 <span class="keyword">end</span>
0060 
0061 <span class="keyword">if</span> ~isfield(opt, <span class="string">'method'</span>)
0062     opt.method = <span class="string">'centre'</span>;
0063 <span class="keyword">end</span>
0064 
0065 img = <a href="../../../eidors/models/data_mapper.html" class="code" title="function img = data_mapper(img, reverse)">data_mapper</a>(img); <span class="comment">% support parametrization</span>
0066 
0067 do_rimg = false;
0068 
0069 <span class="keyword">switch</span> opt.method
0070     <span class="keyword">case</span> <span class="string">'centre'</span>
0071         do_c2f = false;
0072     <span class="keyword">case</span> <span class="string">'average'</span>
0073         do_rimg = true;
0074         do_c2f = true;
0075     <span class="keyword">otherwise</span>
0076         error(<span class="string">'EIDORS:WrongInput'</span>, <span class="string">'Method must be centre or average.'</span>);
0077 <span class="keyword">end</span>
0078 
0079 <span class="keyword">if</span> isfield(img, <span class="string">'node_data'</span>) &amp;&amp; strcmp(opt.method, <span class="string">'average'</span>)
0080     error(<span class="string">'Only the centre method can be used with node data.'</span>);
0081 <span class="keyword">end</span>
0082 
0083 <span class="keyword">if</span> nargout &gt; 1
0084     do_rimg = true;
0085 <span class="keyword">end</span>
0086 
0087 <span class="keyword">if</span> nargin &gt; 2
0088     img.fwd_model = <a href="level_model_slice.html" class="code" title="function [out, out2, out3, out4] = level_model_slice(varargin)">level_model_slice</a>(img.fwd_model, level);
0089 <span class="keyword">end</span>
0090 
0091 [~, ~, ~, opt] = <a href="define_voxels.html" class="code" title="function [xvec, yvec, zvec, opt] = define_voxels(fmdl, varargin)">define_voxels</a>(img.fwd_model, opt);
0092 
0093 <span class="keyword">if</span> do_c2f <span class="comment">% method 'average'</span>
0094     rmdl = <a href="../../../eidors/models/mk_grid_model.html" class="code" title="function [cmdl, c2f]= mk_grid_model(fmdl, xvec, yvec, zvec, removefn);">mk_grid_model</a>([],opt.xvec,opt.yvec,opt.zvec);
0095     c2f = <a href="../../../eidors/models/mk_grid_c2f.html" class="code" title="function [c2f, m] = mk_grid_c2f(fmdl, rmdl, opt)">mk_grid_c2f</a>(img.fwd_model, rmdl, opt);
0096     fvol = <a href="../../../eidors/models/get_elem_volume.html" class="code" title="function VOL = get_elem_volume( fwd_model, map_node )">get_elem_volume</a>(img.fwd_model,<span class="string">'no_c2f'</span>);
0097     <span class="comment">% need bsxfun because of octave, and it's super slow</span>
0098     f2c = bsxfun(@times, c2f, fvol)';
0099     <span class="comment">%f2c = f2c ./ sum(f2c,2); % MATLAB:array:SizeLimitExceeded</span>
0100     f2c = <a href="../../../eidors/tools/spdiag.html" class="code" title="function S = spdiag(V,K)">spdiag</a>(1./sum(f2c,2)) * f2c;
0101     rimg = <a href="../../../eidors/models/mk_image.html" class="code" title="function img= mk_image(mdl, elem_data, params, name)">mk_image</a>(rmdl,f2c*img.elem_data);
0102     V = <a href="calc_grid_points.html" class="code" title="function [val, c2f] = calc_grid_points(img, xpts, ypts, zpts)">calc_grid_points</a>(rimg, opt.x_pts, opt.y_pts, opt.z_pts);
0103 <span class="keyword">else</span> <span class="comment">% method 'centre'</span>
0104     V = <a href="calc_grid_points.html" class="code" title="function [val, c2f] = calc_grid_points(img, xpts, ypts, zpts)">calc_grid_points</a>(img, opt.x_pts, opt.y_pts, opt.z_pts);
0105     <span class="keyword">if</span> do_rimg
0106         rmdl = <a href="../../../eidors/models/mk_grid_model.html" class="code" title="function [cmdl, c2f]= mk_grid_model(fmdl, xvec, yvec, zvec, removefn);">mk_grid_model</a>([],opt.xvec,opt.yvec,opt.zvec);
0107         <a href="../../../eidors/models/num_elems.html" class="code" title="function num = num_elems( mdl );">num_elems</a> = size(rmdl.coarse2fine,2);
0108         rimg = <a href="../../../eidors/models/mk_image.html" class="code" title="function img= mk_image(mdl, elem_data, params, name)">mk_image</a>(rmdl, reshape(V,<a href="../../../eidors/models/num_elems.html" class="code" title="function num = num_elems( mdl );">num_elems</a>,[]));
0109     <span class="keyword">end</span>
0110 <span class="keyword">end</span>
0111 
0112 V = permute(V, [2 1 3 4]);
0113 
0114 <a name="_sub1" href="#_subfunctions" class="code">function do_unit_test</a>
0115 <a href="#_sub2" class="code" title="subfunction do_cases">do_cases</a>
0116 <a href="#_sub4" class="code" title="subfunction do_example">do_example</a>
0117 
0118 <a name="_sub2" href="#_subfunctions" class="code">function do_cases</a>
0119 
0120 imdl= <a href="../../../eidors/models/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>(<span class="string">'n3r2'</span>,[16,2]);
0121 fmdl = imdl.fwd_model;
0122 
0123 obj01 = [390,391,393,396,402,478,479,480,484,486, <span class="keyword">...</span>
0124          664,665,666,667,668,670,671,672,676,677, <span class="keyword">...</span>
0125          678,755,760,761];
0126 obj02 = [318,319,321,324,330,439,440,441,445,447, <span class="keyword">...</span>
0127          592,593,594,595,596,598,599,600,604,605, <span class="keyword">...</span>
0128          606,716,721,722];
0129 
0130 test = 1;
0131 <span class="keyword">while</span> 1
0132     img = <a href="../../../eidors/models/mk_image.html" class="code" title="function img= mk_image(mdl, elem_data, params, name)">mk_image</a>(fmdl, 1);
0133     opt = struct;
0134     error_expected = false;
0135     <span class="keyword">switch</span> test
0136         <span class="keyword">case</span> 1
0137             opt.imgsz = [32 32 32];
0138             opt.cube_voxels = 1;
0139             img.elem_data(obj01) = 1.15;
0140             img.elem_data(obj02) = 0.8;
0141             expect_out =  [22 22 32];
0142         <span class="keyword">case</span> 2
0143             opt.imgsz = [32 32 32];
0144             opt.cube_voxels = 1;
0145             img.elem_data(:,2) = img.elem_data;
0146             img.elem_data(obj01,1) = 1.15;
0147             img.elem_data(obj02,2) = 0.8;
0148             expect_out =  [22 22 32 2];
0149         <span class="keyword">case</span> 3
0150             opt.imgsz = [32 32 32];
0151             opt.cube_voxels = 1;
0152             img.elem_data(:,2) = img.elem_data;
0153             img.elem_data(obj01,1) = 1.15;
0154             img.elem_data(obj02,2) = 0.8;
0155             opt.method = <span class="string">'average'</span>;
0156             expect_out =  [22 22 32 2];
0157         <span class="keyword">case</span> 4
0158             opt.imgsz = [32 32 32];
0159             opt.cube_voxels = 1;
0160             img = <a href="../../../eidors/models/mk_image.html" class="code" title="function img= mk_image(mdl, elem_data, params, name)">mk_image</a>(fmdl, 1:<a href="../../../eidors/models/num_nodes.html" class="code" title="function num = num_nodes( mdl );">num_nodes</a>(fmdl));
0161             expect_out =  [22 22 32];
0162         <span class="keyword">case</span> 5
0163             opt.imgsz = [32 32 32];
0164             opt.cube_voxels = 1;
0165             img = <a href="../../../eidors/models/mk_image.html" class="code" title="function img= mk_image(mdl, elem_data, params, name)">mk_image</a>(fmdl, 1:<a href="../../../eidors/models/num_nodes.html" class="code" title="function num = num_nodes( mdl );">num_nodes</a>(fmdl));
0166             opt.method = <span class="string">'average'</span>;
0167             error_expected = true;
0168         <span class="keyword">case</span> 6 <span class="comment">% empty options</span>
0169             img.elem_data(obj01) = 1.15;
0170             img.elem_data(obj02) = 0.8;
0171             expect_out =  [22 22 32];
0172         <span class="keyword">otherwise</span>
0173             <span class="keyword">break</span>
0174     <span class="keyword">end</span>
0175     test_txt = sprintf(<span class="string">'calc_voxels T#%2d:'</span>, test);
0176     <span class="keyword">try</span>
0177         [V, rimg] = <a href="calc_voxels.html" class="code" title="function [V, rimg] = calc_voxels(img, opt, level)">calc_voxels</a>(img, opt);
0178         <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(test_txt, size(V), expect_out);
0179 <span class="comment">%       fprintf('Test #%2d: %s\n', test, mat2str(size(V)));</span>
0180     <span class="keyword">catch</span> e
0181         <span class="keyword">if</span> error_expected
0182             <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>([test_txt, <span class="string">' expected error'</span>], error_expected,true);
0183         <span class="keyword">else</span>
0184             fprintf(<span class="string">'Test #%2d: error\n'</span>, test);
0185         <span class="keyword">end</span>
0186     <span class="keyword">end</span>
0187 
0188     <a href="#_sub3" class="code" title="subfunction show_test(img, V, rimg)">show_test</a>(img, V, rimg)
0189     test = test + 1;
0190 <span class="keyword">end</span>
0191 
0192 
0193 <a name="_sub3" href="#_subfunctions" class="code">function show_test(img, V, rimg)</a>
0194 s = warning(<span class="string">'query'</span>,<span class="string">'EIDORS:FirstImageOnly'</span>);
0195 warning(<span class="string">'off'</span>,<span class="string">'EIDORS:FirstImageOnly'</span>);
0196 <span class="keyword">try</span>
0197     clf
0198     subplot(131)
0199     <a href="show_fem.html" class="code" title="function hh=show_fem( mdl, options)">show_fem</a>(img)
0200     subplot(132)
0201     <a href="show_fem.html" class="code" title="function hh=show_fem( mdl, options)">show_fem</a>(rimg)
0202     subplot(133)
0203     <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>(V)
0204 <span class="keyword">catch</span> e
0205     warning(s, <span class="string">'EIDORS:FirstImageOnly'</span>);
0206     rethrow(e)
0207 <span class="keyword">end</span>
0208 
0209 <a name="_sub4" href="#_subfunctions" class="code">function do_example</a>
0210  fmdl = <a href="../../../eidors/meshing/netgen/ng_mk_ellip_models.html" class="code" title="function [fmdl,mat_idx] = ng_mk_ellip_models(ellip_shape, elec_pos,elec_shape, extra_ng_code);">ng_mk_ellip_models</a>([1,1.5,0.8,0.1],[],[]);
0211  fmdl.nodes(:,3) = fmdl.nodes(:,3) - .25;
0212  fmdl = <a href="../../../eidors/models/fix_model.html" class="code" title="function [mdl] = fix_model(mdl,opt)">fix_model</a>(fmdl, struct(<span class="string">'elem_centre'</span>,true));
0213  img = <a href="../../../eidors/models/mk_image.html" class="code" title="function img= mk_image(mdl, elem_data, params, name)">mk_image</a>(fmdl, prod(fmdl.elem_centre,2));
0214  [V, rimg] = <a href="calc_voxels.html" class="code" title="function [V, rimg] = calc_voxels(img, opt, level)">calc_voxels</a>(img);
0215  subplot(221), <a href="show_fem.html" class="code" title="function hh=show_fem( mdl, options)">show_fem</a>(img)
0216  subplot(222), <a href="show_fem.html" class="code" title="function hh=show_fem( mdl, options)">show_fem</a>(rimg);
0217  subplot(223), <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>(rimg,3);
0218  subplot(224), <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>(V);</pre></div>
<hr><address>Generated on Sun 29-Dec-2024 19:54:43 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>