<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of print_convert</title>
  <meta name="keywords" content="print_convert">
  <meta name="description" content="PRINT_CONVERT: print figures with anti-aliasing and trim them">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">eidors</a> &gt; <a href="#">graphics</a> &gt; <a href="index.html">matlab</a> &gt; print_convert.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for eidors/graphics/matlab&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>print_convert
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>PRINT_CONVERT: print figures with anti-aliasing and trim them</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function print_convert(filename, varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">PRINT_CONVERT: print figures with anti-aliasing and trim them
  PRINT_CONVERT(FILENAME,OPT) prints current figure to FILENAME, which
  must include extenstion.

  OPT is either a string specifying dpi in the format '-r150' or a struct
  with (some of) these fields:
   opt.resolution   = 150;              % 150 dpi (default: 125)
   opt.pagesize     = [width, height];  % in current PageUnits or 'auto'
                                        % to match the size on the screen
                                        % (default: [8, 6] inches)
   opt.jpeg_quality = 85;               % jpeg quality (default: 85)
   opt.imwrite_opts = {'BitDepth',8};   % options to IMWRITE (default: '')
   opt.horz_cut     = 20;               % remove horizontal gaps larger
                                        % than 50 pixels (default: 20)
   opt.horz_space   = 10;               % replace the removed horizontal
                                        % gaps with 10 px of background
                                        % (default: 10)
   opt.vert_cut     = 20;               % remove vertical gaps larger
                                        % than 50 pixels (default: 20)
   opt.vert_space   = 10;               % replace the removed vertical
                                        % gaps with 10 px of background
                                        % (default: 10)
   opt.supersampling_factor = 2;        % anti-aliasing (default: 1 for
                                        % images, 2 for graphs). Higher is
                                        % smoother.
   opt.crop_slack   = [top,bot,left,right] %don't crop right to boundary
   opt.figno        = number            % print figure, otherwise gca

  Note that opt.imwrite_opts takes precedence over opt.jpeq_quality.

  print_convert has pre-version 3.7 options, which are deprecated

  Examples
   print_convert('outname.png')         % uses default options
   print_convert outname.png
   print_convert outname.png -r150      % set dpi=150
   print_convert outname.png -p10x20    % pagesize 10x20
   print_convert outname.png -pauto     % pagesize = size on screen
   print_convert outname.png -ssf2 -ssf1% supersampling_factor=2,1
   print_convert('outname.png',opts);   % use options

 See also IMWRITE</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../eidors/eidors_msg.html" class="code" title="function log_level = eidors_msg( message, varargin )">eidors_msg</a>	EIDORS_MSG eidors progress and status messages</li><li><a href="../../../eidors/external/export_fig/bitmap_downsize.html" class="code" title="function A = bitmap_downsize(A, factor)">bitmap_downsize</a>	BITMAP_DONWSIZE scale down an image (anti-aliasing)</li><li><a href="print_convert.html" class="code" title="function print_convert(filename, varargin)">print_convert</a>	PRINT_CONVERT: print figures with anti-aliasing and trim them</li><li><a href="show_fem.html" class="code" title="function hh=show_fem( mdl, options)">show_fem</a>	SHOW_FEM: show the EIDORS3D finite element model</li><li><a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>	out_img = show_slices (img, levels ) show slices at levels of an</li><li><a href="../../../eidors/meshing/netgen/ng_mk_cyl_models.html" class="code" title="function [fmdl,mat_idx] = ng_mk_cyl_models(cyl_shape, elec_pos,elec_shape, extra_ng_code);">ng_mk_cyl_models</a>	NG_MAKE_CYL_MODELS: create cylindrical models using netgen</li><li><a href="../../../eidors/models/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>	MK_COMMON_MODEL: make common EIT models</li><li><a href="../../../eidors/models/mk_image.html" class="code" title="function img= mk_image(mdl, elem_data, params, name)">mk_image</a>	MK_IMAGE: create eidors image object</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="print_convert.html" class="code" title="function print_convert(filename, varargin)">print_convert</a>	PRINT_CONVERT: print figures with anti-aliasing and trim them</li><li><a href="../../../eidors/solvers/forward/tools-beta/calc_error_norms_for_square_domain.html" class="code" title="function [L2_tot_error,H1semi_tot_error,H1_tot_error,I_err,U_errS,U_errM,U_errSM,timing_solver,DOF]=error_2D_squ_CEM(img,eletype,plot_on)">calc_error_norms_for_square_domain</a>	Get forward model of the img and the conductivity per element</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function pp = set_pagesize(pp)</a></li><li><a href="#_sub2" class="code">function pp = set_prop(pp, varargin)</a></li><li><a href="#_sub3" class="code">function copy2clipboard(pp)</a></li><li><a href="#_sub4" class="code">function im = crop_image(im,pp)</a></li><li><a href="#_sub5" class="code">function f = default_factor</a></li><li><a href="#_sub6" class="code">function fmt = parse_format(filename)</a></li><li><a href="#_sub7" class="code">function pp = parse_options(filename,varargin)</a></li><li><a href="#_sub8" class="code">function do_unit_test</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function print_convert(filename, varargin)</a>
0002 <span class="comment">%PRINT_CONVERT: print figures with anti-aliasing and trim them</span>
0003 <span class="comment">%  PRINT_CONVERT(FILENAME,OPT) prints current figure to FILENAME, which</span>
0004 <span class="comment">%  must include extenstion.</span>
0005 <span class="comment">%</span>
0006 <span class="comment">%  OPT is either a string specifying dpi in the format '-r150' or a struct</span>
0007 <span class="comment">%  with (some of) these fields:</span>
0008 <span class="comment">%   opt.resolution   = 150;              % 150 dpi (default: 125)</span>
0009 <span class="comment">%   opt.pagesize     = [width, height];  % in current PageUnits or 'auto'</span>
0010 <span class="comment">%                                        % to match the size on the screen</span>
0011 <span class="comment">%                                        % (default: [8, 6] inches)</span>
0012 <span class="comment">%   opt.jpeg_quality = 85;               % jpeg quality (default: 85)</span>
0013 <span class="comment">%   opt.imwrite_opts = {'BitDepth',8};   % options to IMWRITE (default: '')</span>
0014 <span class="comment">%   opt.horz_cut     = 20;               % remove horizontal gaps larger</span>
0015 <span class="comment">%                                        % than 50 pixels (default: 20)</span>
0016 <span class="comment">%   opt.horz_space   = 10;               % replace the removed horizontal</span>
0017 <span class="comment">%                                        % gaps with 10 px of background</span>
0018 <span class="comment">%                                        % (default: 10)</span>
0019 <span class="comment">%   opt.vert_cut     = 20;               % remove vertical gaps larger</span>
0020 <span class="comment">%                                        % than 50 pixels (default: 20)</span>
0021 <span class="comment">%   opt.vert_space   = 10;               % replace the removed vertical</span>
0022 <span class="comment">%                                        % gaps with 10 px of background</span>
0023 <span class="comment">%                                        % (default: 10)</span>
0024 <span class="comment">%   opt.supersampling_factor = 2;        % anti-aliasing (default: 1 for</span>
0025 <span class="comment">%                                        % images, 2 for graphs). Higher is</span>
0026 <span class="comment">%                                        % smoother.</span>
0027 <span class="comment">%   opt.crop_slack   = [top,bot,left,right] %don't crop right to boundary</span>
0028 <span class="comment">%   opt.figno        = number            % print figure, otherwise gca</span>
0029 <span class="comment">%</span>
0030 <span class="comment">%  Note that opt.imwrite_opts takes precedence over opt.jpeq_quality.</span>
0031 <span class="comment">%</span>
0032 <span class="comment">%  print_convert has pre-version 3.7 options, which are deprecated</span>
0033 <span class="comment">%</span>
0034 <span class="comment">%  Examples</span>
0035 <span class="comment">%   print_convert('outname.png')         % uses default options</span>
0036 <span class="comment">%   print_convert outname.png</span>
0037 <span class="comment">%   print_convert outname.png -r150      % set dpi=150</span>
0038 <span class="comment">%   print_convert outname.png -p10x20    % pagesize 10x20</span>
0039 <span class="comment">%   print_convert outname.png -pauto     % pagesize = size on screen</span>
0040 <span class="comment">%   print_convert outname.png -ssf2 -ssf1% supersampling_factor=2,1</span>
0041 <span class="comment">%   print_convert('outname.png',opts);   % use options</span>
0042 <span class="comment">%</span>
0043 <span class="comment">% See also IMWRITE</span>
0044 
0045 <span class="comment">% (C) Andy Adler and Bartlomiej Grychtol 2010-2021. License: GPL v2 or v3.</span>
0046 <span class="comment">% $Id: print_convert.m 6689 2024-03-19 16:04:23Z bgrychtol $</span>
0047 <span class="comment">%</span>
0048 <span class="comment">%  Compatibility with pre-3.7 features:</span>
0049 <span class="comment">%  ------------------------------------</span>
0050 <span class="comment">%  PRINT_CONVERT(FILENAME, OPTIONS, PAGEHWR)</span>
0051 <span class="comment">%</span>
0052 <span class="comment">%  FILENAME : filename to print to file type is the extension</span>
0053 <span class="comment">%  OPTIONS  : specify dpi as '-density N'</span>
0054 <span class="comment">%</span>
0055 <span class="comment">%   print_convert('outname.png','-density 150') % resolution to 150 dpi</span>
0056 
0057 <span class="keyword">if</span> ischar(filename) &amp;&amp; strcmp(filename,<span class="string">'UNIT_TEST'</span>); <a href="#_sub8" class="code" title="subfunction do_unit_test">do_unit_test</a>; <span class="keyword">return</span>; <span class="keyword">end</span>
0058 
0059 pp = <a href="#_sub7" class="code" title="subfunction pp = parse_options(filename,varargin)">parse_options</a>(filename, varargin{:});
0060 
0061 
0062 <span class="comment">% change properties</span>
0063 pp = <a href="#_sub2" class="code" title="subfunction pp = set_prop(pp, varargin)">set_prop</a>(pp,<span class="string">'InvertHardCopy'</span>,<span class="string">'off'</span>);
0064 pp = <a href="#_sub2" class="code" title="subfunction pp = set_prop(pp, varargin)">set_prop</a>(pp,<span class="string">'Color'</span>,<span class="string">'w'</span>);
0065 pp = <a href="#_sub1" class="code" title="subfunction pp = set_pagesize(pp)">set_pagesize</a>(pp);
0066 
0067 <span class="comment">% revert changed properties at exit</span>
0068 cleanupObj = onCleanup(@() set(pp.figno, pp.old{:})); <span class="comment">% current state of pp.old only!</span>
0069 
0070 <span class="comment">% print to array</span>
0071 im = print(pp.figno,<span class="string">'-RGBImage'</span>,pp.resolution);
0072 
0073 im = <a href="../../../eidors/external/export_fig/bitmap_downsize.html" class="code" title="function A = bitmap_downsize(A, factor)">bitmap_downsize</a>(im, pp.factor);
0074 im = <a href="#_sub4" class="code" title="subfunction im = crop_image(im,pp)">crop_image</a>(im,pp);
0075 <span class="keyword">try</span>
0076    imwrite(im,pp.filename,pp.imwrite_opts{:});
0077 <span class="keyword">catch</span> e
0078    <a href="../../../eidors/eidors_msg.html" class="code" title="function log_level = eidors_msg( message, varargin )">eidors_msg</a>([<span class="string">'Call to IMWRITE failed.'</span><span class="keyword">...</span>
0079                <span class="string">'Probably opt.imwrite_opts is incorrect for %s files.'</span>],<span class="keyword">...</span>
0080                upper(pp.fmt), 1);
0081    disp(<span class="string">'opt.imwrite_opts:'</span>);
0082    disp(pp.imwrite_opts);
0083    rethrow(e);
0084 <span class="keyword">end</span>
0085 
0086 <span class="comment">% place file in clipboard</span>
0087 <span class="keyword">if</span> pp.clip
0088    <a href="#_sub3" class="code" title="subfunction copy2clipboard(pp)">copy2clipboard</a>(pp)
0089 <span class="keyword">end</span>
0090 
0091 <a name="_sub1" href="#_subfunctions" class="code">function pp = set_pagesize(pp)</a>
0092 <span class="keyword">if</span> ~isfield(pp, <span class="string">'pagesize'</span>) <span class="comment">% no user definition</span>
0093     pos = [0.25 0.25 8 6]; <span class="comment">% Matlab's default before R2016a</span>
0094     <span class="keyword">if</span> isfield(pp, <span class="string">'aspect_ratio'</span>) <span class="comment">% old interface</span>
0095         pos(4) = pos(3) * pp.aspect_ratio;
0096     <span class="keyword">end</span>
0097     pp = <a href="#_sub2" class="code" title="subfunction pp = set_prop(pp, varargin)">set_prop</a>(pp,   <span class="string">'PaperUnits'</span>,<span class="string">'inches'</span>,<span class="keyword">...</span>
0098                         <span class="string">'PaperPositionMode'</span>,<span class="string">'manual'</span>, <span class="keyword">...</span>
0099                         <span class="string">'PaperPosition'</span>, pos);
0100 <span class="keyword">elseif</span> ischar(pp.pagesize)
0101     <span class="keyword">switch</span> pp.pagesize
0102         <span class="keyword">case</span> <span class="string">'auto'</span>
0103             pp = <a href="#_sub2" class="code" title="subfunction pp = set_prop(pp, varargin)">set_prop</a>(pp, <span class="string">'PaperPositionMode'</span>, <span class="string">'auto'</span>);
0104         <span class="keyword">otherwise</span>
0105             warning(<span class="string">'Page size %s not understood'</span>, pp.pagesize);
0106     <span class="keyword">end</span>
0107 <span class="keyword">else</span>
0108     pos = [0 0 pp.pagesize];
0109     pp = <a href="#_sub2" class="code" title="subfunction pp = set_prop(pp, varargin)">set_prop</a>(pp, <span class="keyword">...</span>
0110         <span class="string">'PaperPositionMode'</span>,<span class="string">'manual'</span>, <span class="keyword">...</span>
0111         <span class="string">'PaperSize'</span>, pp.pagesize+1, <span class="keyword">...</span><span class="comment"> % big enough</span>
0112         <span class="string">'PaperPosition'</span>, pos);
0113 <span class="keyword">end</span>
0114 
0115 <a name="_sub2" href="#_subfunctions" class="code">function pp = set_prop(pp, varargin)</a>
0116     prop = {};
0117     <span class="keyword">for</span> i = 1:2:numel(varargin)
0118         prop(1, end+1) = varargin(i);
0119         prop{2, end  } = get(pp.figno, varargin{i});
0120     <span class="keyword">end</span>
0121     pp.old = [fliplr(prop), pp.old]; <span class="comment">% store in reverse order to revert correctly</span>
0122     set(pp.figno, varargin{:})
0123 
0124 
0125 <a name="_sub3" href="#_subfunctions" class="code">function copy2clipboard(pp)</a>
0126    <span class="keyword">if</span> isunix()
0127       cmd = sprintf([<span class="string">'xclip -selection '</span> <span class="keyword">...</span>
0128           <span class="string">'clipboard -t image/%s -i %s'</span>], <span class="keyword">...</span>
0129             pp.fmt, pp.filename);
0130       [status] = system(cmd);
0131       <span class="keyword">if</span> status ~=0
0132           warning <span class="string">'calling xclip to clipboard failed'</span>;
0133       <span class="keyword">end</span>
0134    <span class="keyword">else</span>
0135       cmd = <span class="string">'Powershell -command Set-Clipboard -Path '</span>;
0136       status = system([cmd pp.filename]);
0137       <span class="keyword">if</span> status ~=0
0138         warning <span class="string">'Powershell Set-Clipboard failed'</span>;
0139       <span class="keyword">end</span>
0140    <span class="keyword">end</span>
0141 
0142 <a name="_sub4" href="#_subfunctions" class="code">function im = crop_image(im,pp)</a>
0143    tu = pp.crop_slack(1);
0144    bu = pp.crop_slack(2) + 1; <span class="comment">%remove starting one more</span>
0145    lu = pp.crop_slack(3);
0146    ru = pp.crop_slack(4) + 1;
0147 
0148    szim = size(im);
0149    bdr = squeeze(mean(double(im(1,:,:)),2));
0150 
0151    isbdr = true(szim(1),szim(2));
0152    <span class="keyword">for</span> i=1:szim(3);
0153      isbdr = isbdr &amp; (im(:,:,i) == bdr(i));
0154    <span class="keyword">end</span>
0155 
0156    horz = [true,all(isbdr,1),true];
0157    horzpt = find(diff(horz)) - 1; <span class="comment">% first 'true'</span>
0158    <span class="keyword">if</span> isempty(horzpt)
0159       <a href="../../../eidors/eidors_msg.html" class="code" title="function log_level = eidors_msg( message, varargin )">eidors_msg</a>(<span class="string">'Image is blank. Cropping aborted.'</span>,1);
0160       <span class="keyword">return</span>
0161    <span class="keyword">end</span>
0162    im(:,horzpt(end)+ru:<span class="keyword">end</span>,:)= []; <span class="comment">% remove higher first</span>
0163    <span class="keyword">if</span> pp.horz_cut &gt;0;
0164       horz_e_pt = find(diff(horz)==-1) -1; horz_e_pt(1) = [];
0165       horz_s_pt = find(diff(horz)==+1)   ; horz_s_pt(end) = [];
0166       idx = find(horz_e_pt - horz_s_pt &gt; pp.horz_cut);
0167       <span class="keyword">for</span> i=fliplr(idx) <span class="comment">% remove higher first</span>
0168         im(:,horz_s_pt(i)+pp.horz_space:horz_e_pt(i),:)= [];
0169       <span class="keyword">end</span>
0170    <span class="keyword">end</span>
0171    im(:,1:horzpt(1)-lu ,:)= [];
0172 
0173    vert = [true,all(isbdr,2)',true];
0174    vertpt = find(diff(vert)) - 1; <span class="comment">% first 'true'</span>
0175    im(vertpt(end)+bu:<span class="keyword">end</span>,:,:)= [];
0176    <span class="keyword">if</span> pp.vert_cut &gt;0;
0177       vert_e_pt = find(diff(vert)==-1) -1; vert_e_pt(1) = [];
0178       vert_s_pt = find(diff(vert)==+1)   ; vert_s_pt(end) = [];
0179       idx = find(vert_e_pt - vert_s_pt &gt; pp.vert_cut);
0180       <span class="keyword">for</span> i=fliplr(idx) <span class="comment">% remove higher first</span>
0181         im(vert_s_pt(i)+pp.vert_space:vert_e_pt(i),:,:)= [];
0182       <span class="keyword">end</span>
0183    <span class="keyword">end</span>
0184    im(1:vertpt(1)-tu ,:,:)= [];
0185 
0186 
0187 <span class="comment">% factor = 1 if all plots only contain images, 2 otherwise</span>
0188 <a name="_sub5" href="#_subfunctions" class="code">function f = default_factor</a>
0189    f = 1; <span class="comment">% default for images</span>
0190    sp = get(gcf,<span class="string">'Children'</span>); <span class="comment">% subplots</span>
0191    <span class="keyword">for</span> i = 1:length(sp)
0192       obj = get(sp(i),<span class="string">'Children'</span>);
0193       tp  = get(obj,<span class="string">'Type'</span>);
0194       <span class="keyword">if</span> ~all(strcmp(tp,<span class="string">'image'</span>))
0195          f = 2;
0196          <span class="keyword">return</span>;
0197       <span class="keyword">end</span>
0198    <span class="keyword">end</span>
0199 
0200 <a name="_sub6" href="#_subfunctions" class="code">function fmt = parse_format(filename)</a>
0201     ext = lower(regexp(filename,<span class="string">'(?&lt;=\.).+$'</span>,<span class="string">'match'</span>));
0202     <span class="keyword">if</span> isempty(ext); error(<span class="string">'no filename extension detected (%s)'</span>,filename); <span class="keyword">end</span>
0203     <span class="keyword">switch</span> ext{1}
0204        <span class="keyword">case</span> {<span class="string">'jpg'</span>, <span class="string">'jpeg'</span>}
0205           fmt = <span class="string">'jpg'</span>;
0206        <span class="keyword">case</span> {<span class="string">'j2c'</span>, <span class="string">'j2k'</span>, <span class="string">'jp2'</span>}
0207           fmt = <span class="string">'jp2'</span>;
0208        <span class="keyword">case</span> {<span class="string">'tif'</span>,<span class="string">'tiff'</span>}
0209           fmt = <span class="string">'tif'</span>;
0210        <span class="keyword">otherwise</span>
0211           fmt = ext{1};
0212     <span class="keyword">end</span>
0213 
0214 <a name="_sub7" href="#_subfunctions" class="code">function pp = parse_options(filename,varargin)</a>
0215 
0216    pp.fmt = <a href="#_sub6" class="code" title="subfunction fmt = parse_format(filename)">parse_format</a>(filename);
0217    <span class="keyword">if</span> strcmp(filename, [<span class="string">'{clipboard}.'</span>,pp.fmt])
0218       pp.clip = true;
0219       pp.filename = [tempname(),<span class="string">'.'</span>,pp.fmt];
0220    <span class="keyword">else</span>
0221       pp.clip = false;
0222       pp.filename = filename;
0223    <span class="keyword">end</span>
0224 
0225    pp.jpeg_quality = 85; <span class="comment">% default jpeg quality</span>
0226    pp.imwrite_opts = {}; <span class="comment">% initial</span>
0227    pp.horz_cut = 20;
0228    pp.horz_space = 10;
0229    pp.vert_cut = 20;
0230    pp.vert_space = 10;
0231    pp.factor = <a href="#_sub5" class="code" title="subfunction f = default_factor">default_factor</a>;
0232    pp.resolution = sprintf(<span class="string">'-r%d'</span>,125 * pp.factor);
0233    pp.crop_slack = [0,0,0,0];
0234    pp.figno = get(gcf,<span class="string">'Number'</span>);
0235    pp.old = {};
0236 
0237 
0238 <span class="comment">% Old options</span>
0239    <span class="keyword">if</span> nargin == 1
0240       <span class="keyword">return</span>;
0241    <span class="keyword">end</span>
0242 
0243    opt = varargin{1};
0244    <span class="keyword">if</span> ischar(opt)
0245       <span class="keyword">for</span> i = 1:length(varargin); opt = varargin{i}; parseok=false;
0246           val =regexp(opt,<span class="string">'-density (\d+)'</span>,<span class="string">'tokens'</span>);
0247           <span class="keyword">if</span> ~isempty(val);
0248              pp.resolution = sprintf(<span class="string">'-r%d'</span>, str2double(val{1}{1}) * pp.factor);
0249              parseok=true;
0250           <span class="keyword">end</span>
0251 
0252           val =regexp(opt,<span class="string">'-r(\d+)'</span>,<span class="string">'tokens'</span>);
0253           <span class="keyword">if</span> ~isempty(val);
0254              pp.resolution = sprintf(<span class="string">'-r%d'</span>, str2double(val{1}{1}) * pp.factor);
0255              parseok=true;
0256           <span class="keyword">end</span>
0257 
0258           <span class="keyword">if</span> strcmp(opt,<span class="string">'-pauto'</span>)
0259              pp.pagesize = <span class="string">'auto'</span>;
0260              parseok=true;
0261           <span class="keyword">end</span>
0262 
0263           val =regexp(opt,<span class="string">'-p(\d+)x(\d+)'</span>,<span class="string">'tokens'</span>);
0264           <span class="keyword">if</span> ~isempty(val);
0265              pp.pagesize = [str2num(val{1}{1}), str2num(val{1}{2})];
0266              parseok=true;
0267           <span class="keyword">end</span>
0268 
0269           val =regexp(opt,<span class="string">'-ssf(\d+)'</span>,<span class="string">'tokens'</span>);
0270           <span class="keyword">if</span> ~isempty(val);
0271              pp.supersampling_factor = str2num(val{1}{1});
0272              parseok=true;
0273           <span class="keyword">end</span>
0274 
0275           <span class="keyword">if</span> ~parseok
0276              <a href="../../../eidors/eidors_msg.html" class="code" title="function log_level = eidors_msg( message, varargin )">eidors_msg</a>(<span class="string">'print_convert: option (%s) not understood'</span>,opt,0)
0277           <span class="keyword">end</span>
0278       <span class="keyword">end</span>
0279    <span class="keyword">elseif</span> isstruct(opt)
0280      <span class="keyword">if</span> isfield(opt,<span class="string">'figno'</span>);
0281         pp.figno = opt.figno;
0282      <span class="keyword">end</span>
0283      <span class="keyword">if</span> isfield(opt,<span class="string">'supersampling_factor'</span>)
0284         pp.factor = opt.supersampling_factor;
0285      <span class="keyword">end</span>
0286      <span class="keyword">if</span> isfield(opt,<span class="string">'resolution'</span>);
0287          pp.resolution = sprintf(<span class="string">'-r%d'</span>, opt.resolution * pp.factor);
0288      <span class="keyword">else</span>
0289          pp.resolution = sprintf(<span class="string">'-r%d'</span>,125 * pp.factor);
0290      <span class="keyword">end</span>
0291      <span class="keyword">if</span> isfield(opt,<span class="string">'pagesize'</span>);
0292          pp.pagesize = opt.pagesize;
0293      <span class="keyword">end</span>
0294      <span class="comment">% TODO, this code can copy from opt to pp</span>
0295      <span class="keyword">if</span> isfield(opt,<span class="string">'jpeg_quality'</span>)
0296         pp.jpeg_quality = opt.jpeg_quality;
0297      <span class="keyword">end</span>
0298      <span class="keyword">if</span> strcmp(pp.fmt,<span class="string">'jpg'</span>)
0299         pp.imwrite_opts = {<span class="string">'quality'</span>,pp.jpeg_quality};
0300      <span class="keyword">end</span>
0301      <span class="keyword">if</span> isfield(opt,<span class="string">'imwrite_opts'</span>);
0302         pp.imwrite_opts = opt.imwrite_opts;
0303         <span class="keyword">if</span> strcmp(pp.fmt,<span class="string">'jpg'</span>) &amp;&amp; ~any(strcmpi(pp.imwrite_opts,<span class="string">'quality'</span>))
0304            pp.imwrite_opts(end+1:end+2) = {<span class="string">'quality'</span>,pp.jpeg_quality};
0305         <span class="keyword">end</span>
0306      <span class="keyword">end</span>
0307 
0308      <span class="keyword">if</span> isfield(opt,<span class="string">'horz_cut'</span>);
0309          pp.horz_cut = opt.horz_cut;
0310      <span class="keyword">end</span>
0311      <span class="keyword">if</span> isfield(opt,<span class="string">'vert_cut'</span>);
0312          pp.vert_cut = opt.vert_cut;
0313      <span class="keyword">end</span>
0314      <span class="keyword">if</span> isfield(opt,<span class="string">'vert_space'</span>);
0315         <span class="keyword">if</span> opt.vert_space &gt;= pp.vert_cut;
0316            warning(<span class="string">'Option vert_space must be smaller than vert_cut. Ingoring'</span>);
0317         <span class="keyword">else</span>
0318            pp.vert_space = opt.vert_space;
0319         <span class="keyword">end</span>
0320      <span class="keyword">end</span>
0321      <span class="keyword">if</span> isfield(opt,<span class="string">'horz_space'</span>);
0322         <span class="keyword">if</span> opt.horz_space &gt;= pp.horz_cut;
0323            warning(<span class="string">'Option vert_space must be smaller than vert_cut. Ingoring'</span>);
0324         <span class="keyword">else</span>
0325            pp.horz_space = opt.horz_space;
0326         <span class="keyword">end</span>
0327      <span class="keyword">end</span>
0328      <span class="keyword">if</span> isfield(opt,<span class="string">'crop_slack'</span>);
0329         pp.crop_slack = opt.crop_slack;
0330      <span class="keyword">end</span>
0331    <span class="keyword">else</span>
0332       error(<span class="string">'Can''t parse options'</span>);
0333    <span class="keyword">end</span>
0334 
0335 
0336 <a name="_sub8" href="#_subfunctions" class="code">function do_unit_test</a>
0337    fprintf(<span class="string">'Doing UNIT_TEST for print_convert\n'</span>);
0338    fid = fopen(<span class="string">'print_convert_test.html'</span>,<span class="string">'w'</span>);
0339    fprintf(fid,<span class="string">'&lt;HTML&gt;&lt;BODY&gt;\n'</span>);
0340    <span class="keyword">for</span> i=1:26;
0341      <span class="keyword">switch</span> i;
0342        <span class="keyword">case</span> {9,10}; typ = <span class="string">'jpg'</span>;
0343        <span class="keyword">otherwise</span>; typ = <span class="string">'png'</span>;
0344      <span class="keyword">end</span>
0345      fprintf(fid,<span class="keyword">...</span>
0346      <span class="string">'&lt;H1&gt;%02d&lt;/H1&gt;&lt;table border=1&gt;&lt;tr&gt;&lt;td&gt;&lt;img src=&quot;pc%02d.%s&quot;&gt;&lt;/table&gt;\n'</span>,i,i,typ);
0347    <span class="keyword">end</span>
0348    fprintf(fid,<span class="string">'&lt;/BODY&gt;&lt;/HTML&gt;\n'</span>);
0349    fclose(fid);
0350    <a href="../../../eidors/eidors_msg.html" class="code" title="function log_level = eidors_msg( message, varargin )">eidors_msg</a>(<span class="string">'TO VIEW OUTPUT, OPEN FILE print_convert_test.html'</span>,1);
0351 
0352    im = <a href="../../../eidors/models/mk_image.html" class="code" title="function img= mk_image(mdl, elem_data, params, name)">mk_image</a>( <a href="../../../eidors/meshing/netgen/ng_mk_cyl_models.html" class="code" title="function [fmdl,mat_idx] = ng_mk_cyl_models(cyl_shape, elec_pos,elec_shape, extra_ng_code);">ng_mk_cyl_models</a>(1,[16,.5],.05),1);
0353    clf; <a href="show_fem.html" class="code" title="function hh=show_fem( mdl, options)">show_fem</a>(im);
0354    <a href="print_convert.html" class="code" title="function print_convert(filename, varargin)">print_convert</a> pc01.png
0355 
0356    im = <a href="../../../eidors/models/mk_image.html" class="code" title="function img= mk_image(mdl, elem_data, params, name)">mk_image</a>( <a href="../../../eidors/models/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>(<span class="string">'b2c2'</span>,8), 1:256);
0357    clf; <a href="show_fem.html" class="code" title="function hh=show_fem( mdl, options)">show_fem</a>(im);
0358    <a href="print_convert.html" class="code" title="function print_convert(filename, varargin)">print_convert</a> pc02.png
0359 
0360 
0361    clf; subplot(221); <a href="show_fem.html" class="code" title="function hh=show_fem( mdl, options)">show_fem</a>(im);
0362         subplot(224); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>(im);
0363    <a href="print_convert.html" class="code" title="function print_convert(filename, varargin)">print_convert</a> pc03.png
0364 
0365    <a href="print_convert.html" class="code" title="function print_convert(filename, varargin)">print_convert</a> pc04.png <span class="string">'-density 50'</span>
0366    <a href="print_convert.html" class="code" title="function print_convert(filename, varargin)">print_convert</a> pc05.png <span class="string">'-r100'</span>
0367 
0368    <a href="print_convert.html" class="code" title="function print_convert(filename, varargin)">print_convert</a> pc05.png <span class="string">'-p10x20'</span>
0369    <a href="print_convert.html" class="code" title="function print_convert(filename, varargin)">print_convert</a> pc05.png <span class="string">'-pauto'</span>
0370    <a href="print_convert.html" class="code" title="function print_convert(filename, varargin)">print_convert</a> pc06.png <span class="string">'-r100'</span> <span class="string">'-p10x20'</span>
0371 
0372 <span class="comment">% No longer supported ... not useful</span>
0373 <span class="comment">%  print_convert('pc06.png', '-r100' , 1/8)</span>
0374 <span class="comment">%  print_convert('pc06.png', '-r100' , 3/1)</span>
0375 
0376    opt.resolution = 100;
0377    <a href="print_convert.html" class="code" title="function print_convert(filename, varargin)">print_convert</a>(<span class="string">'pc07.png'</span>, opt);
0378    opt.pagesize = [8,2];
0379    <a href="print_convert.html" class="code" title="function print_convert(filename, varargin)">print_convert</a>(<span class="string">'pc08.png'</span>, opt);
0380 
0381    <a href="print_convert.html" class="code" title="function print_convert(filename, varargin)">print_convert</a>(<span class="string">'pc09a.jpg'</span>);
0382 
0383    opt.pagesize = [8,6];
0384    <a href="print_convert.html" class="code" title="function print_convert(filename, varargin)">print_convert</a>(<span class="string">'pc09.jpg'</span>, opt);
0385 
0386 
0387    opt.imwrite_opts = {<span class="string">'Quality'</span>,20};
0388    <a href="print_convert.html" class="code" title="function print_convert(filename, varargin)">print_convert</a>(<span class="string">'pc10.jpg'</span>, opt);
0389 
0390    opt.imwrite_opts = {<span class="string">'Quality'</span>,100};
0391    <a href="print_convert.html" class="code" title="function print_convert(filename, varargin)">print_convert</a>(<span class="string">'pc10b.jpg'</span>, opt);
0392 
0393    opt.imwrite_opts = {};
0394    opt.horz_cut = 50;
0395    <a href="print_convert.html" class="code" title="function print_convert(filename, varargin)">print_convert</a>(<span class="string">'pc11.png'</span>, opt);
0396 
0397    opt.vert_cut = 50;
0398    <a href="print_convert.html" class="code" title="function print_convert(filename, varargin)">print_convert</a>(<span class="string">'pc12.png'</span>, opt);
0399 
0400    clf; subplot(331); <a href="show_fem.html" class="code" title="function hh=show_fem( mdl, options)">show_fem</a>(im);
0401         subplot(335); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>(im);
0402         subplot(339); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>(im);
0403    opt.vert_cut = 30;
0404    <a href="print_convert.html" class="code" title="function print_convert(filename, varargin)">print_convert</a>(<span class="string">'pc13.png'</span>, opt);
0405 
0406    im = <a href="../../../eidors/models/mk_image.html" class="code" title="function img= mk_image(mdl, elem_data, params, name)">mk_image</a>( <a href="../../../eidors/meshing/netgen/ng_mk_cyl_models.html" class="code" title="function [fmdl,mat_idx] = ng_mk_cyl_models(cyl_shape, elec_pos,elec_shape, extra_ng_code);">ng_mk_cyl_models</a>(1,[16,.5],.05),1);
0407    clf; <a href="show_fem.html" class="code" title="function hh=show_fem( mdl, options)">show_fem</a>(im);
0408    clear opt; opt.supersampling_factor = 1;
0409    <a href="print_convert.html" class="code" title="function print_convert(filename, varargin)">print_convert</a>(<span class="string">'pc14.png'</span>, opt);
0410 
0411    clear opt; opt.supersampling_factor = 2;
0412    <a href="print_convert.html" class="code" title="function print_convert(filename, varargin)">print_convert</a>(<span class="string">'pc15.png'</span>, opt);
0413 
0414    clear opt; opt.supersampling_factor = 3;
0415    <a href="print_convert.html" class="code" title="function print_convert(filename, varargin)">print_convert</a>(<span class="string">'pc16.png'</span>, opt);
0416 
0417    clear opt; opt.supersampling_factor = 4;
0418    <a href="print_convert.html" class="code" title="function print_convert(filename, varargin)">print_convert</a>(<span class="string">'pc17.png'</span>, opt);
0419 
0420    clear opt; opt.supersampling_factor = 8;
0421    <a href="print_convert.html" class="code" title="function print_convert(filename, varargin)">print_convert</a>(<span class="string">'pc18.png'</span>, opt);
0422 
0423</pre></div>
<hr><address>Generated on Sun 29-Dec-2024 19:54:43 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>