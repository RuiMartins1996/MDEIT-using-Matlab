<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of show_slices</title>
  <meta name="keywords" content="show_slices">
  <meta name="description" content="out_img = show_slices (img, levels ) show slices at levels of an">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">eidors</a> &gt; <a href="#">graphics</a> &gt; <a href="index.html">matlab</a> &gt; show_slices.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for eidors/graphics/matlab&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>show_slices
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>out_img = show_slices (img, levels ) show slices at levels of an</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function out_img= show_slices( img, levels, vh ) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> out_img = show_slices (img, levels ) show slices at levels of an
             using a fast rendering algorithm
 img    = EIDORS image struct, or a array of structs
          or output of CALC_SLICES (or equivalent multi-dimensional
          picture array to be processed by mk_mosaic
 out_img= matrix in the current colormap which we can use image(out_img);

 PARAMETERS:
  levels = any level defintion accepted by level_model_slice
  vh     = [Lx2] matrix specifying the horizontal (column), vertical (row)
           position of each slice in the output image
 
 IMAGE PARAMETERS:
   img.show_slices.levels (same as above);
   img.show_slices.img_cols = number of columns in image
   img.show_slices.sep = number of pixels between the individual images
   img.show_slices.do_colourbar = draw a colourbar (via calc_colours)
   img.calc_colours.npoints = pixel width/height to map to
   img.get_img_data.frame_select = which frames of image to display
   img.show_slices.axes_msm = use mdl_slice_mapper for x,y axes
        (only works for single images and when level is specified on the 
        image struct)
        %% Example
        img.fwd_model.mdl_slice_mapper = struct('level',[inf,0,inf], ...
          'x_pts', linspace(-2,2,50), 'y_pts',linspace(2,10,100));
        img.show_slices.axes_msm = true; show_slices(img);
   img.show_slices.contour_levels = true =&gt; Do a contour on the image
   img.show_slices.contour_levels = #    =&gt; Put this many contour lines
   img.show_slices.contour_levels = vector =&gt; Put contours at these locations
   img.show_slices.contour_properties =&gt; e.g. {'Color',[0,0,0],'LineWidth',2}
   img.calc_slices.filter =&gt; e.g. conv2(ones(5),ones(5))/5^4   

 Show slices is roughly equivalent to:
   rimg = calc_slices(img,levels); 
   rimg = calc_colours(rimg,img); image(rimg);

 Deprecated interface:
  if levels is [L x 5] then levels= [x,y,z,h,v] where,
           x,y,z specify the axes intercepts, and 
           h,v   specify the horizontal, vertical position
                 of that slice in the output image

 See also: <a href="level_model_slice.html" class="code" title="function [out, out2, out3, out4] = level_model_slice(varargin)">LEVEL_MODEL_SLICE</a>, <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">CALC_SLICES</a>, <a href="mk_mosaic.html" class="code" title="function r_img = mk_mosaic(rimg, sep, vh, n_col)">MK_MOSAIC</a>, <a href="calc_colours.html" class="code" title="function [colours,scl_data]= calc_colours(img, set_value, do_colourbar)">CALC_COLOURS</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="calc_colours.html" class="code" title="function [colours,scl_data]= calc_colours(img, set_value, do_colourbar)">calc_colours</a>	[colours,scl_data]= calc_colours(img, set_value, do_colourbar)</li><li><a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>	calc_slices (img, levels, clim  ) show slices at levels of an</li><li><a href="mdl_slice_mapper.html" class="code" title="function map = mdl_slice_mapper( fmdl, maptype )">mdl_slice_mapper</a>	MDL_SLICE_MAPPER: map pixels to FEM elements or nodes</li><li><a href="mk_mosaic.html" class="code" title="function r_img = mk_mosaic(rimg, sep, vh, n_col)">mk_mosaic</a>	MK_MOSAIC Arrange multidimensional image matrix for display.</li><li><a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>	out_img = show_slices (img, levels ) show slices at levels of an</li><li><a href="../../../eidors/models/interp_mesh.html" class="code" title="function mdl_pts = interp_mesh( mdl, n_interp)">interp_mesh</a>	INTERP_MESH: calculate interpolation points onto mdl elements</li><li><a href="../../../eidors/models/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>	MK_COMMON_MODEL: make common EIT models</li><li><a href="../../../eidors/models/mk_grid_model.html" class="code" title="function [cmdl, c2f]= mk_grid_model(fmdl, xvec, yvec, zvec, removefn);">mk_grid_model</a>	MK_GRID_MODEL: Create reconstruction model on pixelated grid</li><li><a href="../../../eidors/models/mk_image.html" class="code" title="function img= mk_image(mdl, elem_data, params, name)">mk_image</a>	MK_IMAGE: create eidors image object</li><li><a href="../../../eidors/solvers/calc_jacobian_bkgnd.html" class="code" title="function img_bkgnd = calc_jacobian_bkgnd( inv_model )">calc_jacobian_bkgnd</a>	CALC_JACOBIAN_BKGND: calculate background image around</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../eidors/deprecated/manchester_tomography.html" class="code" title="function manchester_tomography( example_no)">manchester_tomography</a>	Example to show reconstructions from</li><li><a href="../../../eidors/deprecated/solve_RM_2Dslice.html" class="code" title="function imdl = select_RM_slice(imdl, sel_fcn)">solve_RM_2Dslice</a>	SELECT_RM_SLICE: cut slices out of an inverse model with a</li><li><a href="../../../eidors/examples/cheating_2d.html" class="code" title="function out=cheating_2d( figno, rand_seed )">cheating_2d</a>	code to simulate inverse crimes in EIT</li><li><a href="../../../eidors/examples/compare_2d_algs.html" class="code" title="function [imgr, img]= compare_2d_algs(option,shape);">compare_2d_algs</a>	Compare different 2D reconstructions</li><li><a href="../../../eidors/examples/compare_3d_algs.html" class="code" title="function imgr= compare_3d_algs( algno )">compare_3d_algs</a>	Compare different 3D reconstructions</li><li><a href="../../../eidors/examples/demo_2d_simdata.html" class="code" title="">demo_2d_simdata</a>	Example of using EIDORS to simulate 2D data and to</li><li><a href="../../../eidors/examples/demo_3d_simdata.html" class="code" title="">demo_3d_simdata</a>	How to make simulation data using EIDORS3D</li><li><a href="../../../eidors/examples/ex_fwd3d_high_order.html" class="code" title="">ex_fwd3d_high_order</a>	Make common model, and make an image</li><li><a href="animate_reconstructions.html" class="code" title="function fname_out= animate_reconstructions(fname, imgs);">animate_reconstructions</a>	animate_reconstructions(fname, imgs);</li><li><a href="calc_grid_points.html" class="code" title="function [val, c2f] = calc_grid_points(img, xpts, ypts, zpts)">calc_grid_points</a>	CALC_GRID_POINTS - image values at points in grid</li><li><a href="calc_voxels.html" class="code" title="function [V, rimg] = calc_voxels(img, opt, level)">calc_voxels</a>	CALC_VOXELS Calculate volumetric data from an image</li><li><a href="eidors_colourbar.html" class="code" title="function hh= eidors_colourbar(max_scale,ref_lev, cb_shrink_move, greyscale)">eidors_colourbar</a>	EIDORS_COLOURBAR - create an eidors colourbar with scaling to image</li><li><a href="mdl_slice_mapper.html" class="code" title="function map = mdl_slice_mapper( fmdl, maptype )">mdl_slice_mapper</a>	MDL_SLICE_MAPPER: map pixels to FEM elements or nodes</li><li><a href="print_convert.html" class="code" title="function print_convert(filename, varargin)">print_convert</a>	PRINT_CONVERT: print figures with anti-aliasing and trim them</li><li><a href="set_slice.html" class="code" title="function img = set_slice(img, level, spec)">set_slice</a>	SET_SLICE  Set parameters for slice display.</li><li><a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>	out_img = show_slices (img, levels ) show slices at levels of an</li><li><a href="show_slices_move.html" class="code" title="function show_slices_move( img, move, move_scale )">show_slices_move</a>	SHOW_SLICES_MOVE   Shows planar slices of a 3D FEM with movement vectors</li><li><a href="../../../eidors/interface/eidors_readdata.html" class="code" title="function [vv, auxdata, stim]= eidors_readdata( fname, format, frame_range, extra )">eidors_readdata</a>	EIDORS readdata - read data files from various EIT equipment</li><li><a href="../../../eidors/interface/eidors_saveimg.html" class="code" title="function eidors_saveimg( img, fname, format, pp )">eidors_saveimg</a>	EIDORS saveimg - save reconstructed image files in formats</li><li><a href="../../../eidors/interface/find_frc.html" class="code" title="function [eexpi,einsp]= find_frc( imgs, ROI, frate, name, ok, remove_pts)">find_frc</a>	FIND_FRC: find candidates for FRC</li><li><a href="../../../eidors/interface/sigmatome2_filter.html" class="code" title="function [Filter, stim_pattern]= sigmatome2_filter(test);">sigmatome2_filter</a>	SIGMATOME2_FILTER:  Hardware filter and stim_patterns for Sigmatome II device</li><li><a href="../../../eidors/models/GREIT3D_distribution.html" class="code" title="function [imdl,distr] = GREIT3D_distribution(fmdl, vopt)">GREIT3D_distribution</a>	GREIT3D_distribution: create target distributions for 3D GREIT</li><li><a href="../../../eidors/models/define_ROIs.html" class="code" title="function [ROIs, imgR, imdl] = define_ROIs(imdl, varargin)">define_ROIs</a>	DEFINE_ROIS: define ROI regions in image</li><li><a href="../../../eidors/models/map_RM_slice.html" class="code" title="function imdl = map_RM_slice(imdl,varargin)">map_RM_slice</a>	map_RM_slice - map a 3D reconstruction matrix to an arbitrary 2D slice</li><li><a href="../../../eidors/models/mk_GREIT_model.html" class="code" title="function [imdl, weight]= mk_GREIT_model( fmdl, radius, weight, options )">mk_GREIT_model</a>	MK_GREIT_MODEL: make EIDORS inverse models using the GREIT approach</li><li><a href="../../../eidors/models/mk_pixel_slice.html" class="code" title="function [imdl fmdl] = mk_pixel_slice(imdl,level,opt)">mk_pixel_slice</a>	MK_PIXEL_SLICE create a pixel model to reconstruct on</li><li><a href="../../../eidors/models/select_RM_slice.html" class="code" title="function imdl = select_RM_slice(imdl, sel_fcn)">select_RM_slice</a>	SELECT_RM_SLICE: cut slices out of an inverse model with a</li><li><a href="../../../eidors/models/select_imdl.html" class="code" title="function [inv_mdl,opt_out]= select_imdl( mdl, options )">select_imdl</a>	SELECT_IMDL: select pre-packaged inverse model features</li><li><a href="../../../eidors/models/simulate_2d_movement.html" class="code" title="function [vh,vi,xyr_pt]= simulate_2d_movement( n_sims, fmdl, rad_pr, movefcn )">simulate_2d_movement</a>	SIMULATE_2D_MOVEMENT simulate rotational movement in 2D</li><li><a href="../../../eidors/models/simulate_3d_movement.html" class="code" title="function [vh,vi,xyzr_pt]= simulate_3d_movement( n_sims, fmdl, rad_pr,movefcn )">simulate_3d_movement</a>	SIMULATE_3D_MOVEMENT simulate rotational movement in 3D</li><li><a href="../../../eidors/sample_data/write_hdf5_sample.html" class="code" title="function fname = write_and_test;">write_hdf5_sample</a>	Write HDF5 Sample data</li><li><a href="../../../eidors/solvers/forward/jacobian_adjoint_higher_order.html" class="code" title="function J = jacobian_adjoint_higher_order(fwd_model,img)">jacobian_adjoint_higher_order</a>	Find the Jacobian associated with an image (and forward model)</li><li><a href="../../../eidors/solvers/inv_solve.html" class="code" title="function img = inv_solve( inv_model, data1, data2)">inv_solve</a>	INV_SOLVE: calculate imag from an inv_model and data</li><li><a href="../../../eidors/solvers/inverse/calc_lambda_regtools.html" class="code" title="function lambdas = calc_lambda_regtools(imdl, vh, vi, type, doPlot)">calc_lambda_regtools</a>	% CALC_LAMBDA_REGTOOLS: Find optimal hyperparameter by the L-curve (LCC)</li><li><a href="../../../eidors/solvers/inverse/inv_solve_TSVD.html" class="code" title="function sol = inv_solve_TSVD(inv_model, data1, data2)">inv_solve_TSVD</a>	INV_SOLVE_TSVD: inverse solver based on truncatated SVD</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function do_unit_test</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function out_img= show_slices( img, levels, vh )</a>
0002 <span class="comment">% out_img = show_slices (img, levels ) show slices at levels of an</span>
0003 <span class="comment">%             using a fast rendering algorithm</span>
0004 <span class="comment">% img    = EIDORS image struct, or a array of structs</span>
0005 <span class="comment">%          or output of CALC_SLICES (or equivalent multi-dimensional</span>
0006 <span class="comment">%          picture array to be processed by mk_mosaic</span>
0007 <span class="comment">% out_img= matrix in the current colormap which we can use image(out_img);</span>
0008 <span class="comment">%</span>
0009 <span class="comment">% PARAMETERS:</span>
0010 <span class="comment">%  levels = any level defintion accepted by level_model_slice</span>
0011 <span class="comment">%  vh     = [Lx2] matrix specifying the horizontal (column), vertical (row)</span>
0012 <span class="comment">%           position of each slice in the output image</span>
0013 <span class="comment">%</span>
0014 <span class="comment">% IMAGE PARAMETERS:</span>
0015 <span class="comment">%   img.show_slices.levels (same as above);</span>
0016 <span class="comment">%   img.show_slices.img_cols = number of columns in image</span>
0017 <span class="comment">%   img.show_slices.sep = number of pixels between the individual images</span>
0018 <span class="comment">%   img.show_slices.do_colourbar = draw a colourbar (via calc_colours)</span>
0019 <span class="comment">%   img.calc_colours.npoints = pixel width/height to map to</span>
0020 <span class="comment">%   img.get_img_data.frame_select = which frames of image to display</span>
0021 <span class="comment">%   img.show_slices.axes_msm = use mdl_slice_mapper for x,y axes</span>
0022 <span class="comment">%        (only works for single images and when level is specified on the</span>
0023 <span class="comment">%        image struct)</span>
0024 <span class="comment">%        %% Example</span>
0025 <span class="comment">%        img.fwd_model.mdl_slice_mapper = struct('level',[inf,0,inf], ...</span>
0026 <span class="comment">%          'x_pts', linspace(-2,2,50), 'y_pts',linspace(2,10,100));</span>
0027 <span class="comment">%        img.show_slices.axes_msm = true; show_slices(img);</span>
0028 <span class="comment">%   img.show_slices.contour_levels = true =&gt; Do a contour on the image</span>
0029 <span class="comment">%   img.show_slices.contour_levels = #    =&gt; Put this many contour lines</span>
0030 <span class="comment">%   img.show_slices.contour_levels = vector =&gt; Put contours at these locations</span>
0031 <span class="comment">%   img.show_slices.contour_properties =&gt; e.g. {'Color',[0,0,0],'LineWidth',2}</span>
0032 <span class="comment">%   img.calc_slices.filter =&gt; e.g. conv2(ones(5),ones(5))/5^4</span>
0033 <span class="comment">%</span>
0034 <span class="comment">% Show slices is roughly equivalent to:</span>
0035 <span class="comment">%   rimg = calc_slices(img,levels);</span>
0036 <span class="comment">%   rimg = calc_colours(rimg,img); image(rimg);</span>
0037 <span class="comment">%</span>
0038 <span class="comment">% Deprecated interface:</span>
0039 <span class="comment">%  if levels is [L x 5] then levels= [x,y,z,h,v] where,</span>
0040 <span class="comment">%           x,y,z specify the axes intercepts, and</span>
0041 <span class="comment">%           h,v   specify the horizontal, vertical position</span>
0042 <span class="comment">%                 of that slice in the output image</span>
0043 <span class="comment">%</span>
0044 <span class="comment">% See also: LEVEL_MODEL_SLICE, CALC_SLICES, MK_MOSAIC, CALC_COLOURS</span>
0045 
0046 <span class="comment">% (C) 2005-2024 Andy Adler. License: GPL version 2 or version 3</span>
0047 <span class="comment">% $Id: show_slices.m 7090 2024-12-20 20:25:43Z aadler $</span>
0048 
0049 <span class="keyword">if</span> ischar(img) &amp;&amp; strcmp(img,<span class="string">'UNIT_TEST'</span>); <a href="#_sub1" class="code" title="subfunction do_unit_test">do_unit_test</a>; <span class="keyword">return</span>; <span class="keyword">end</span>
0050 
0051 sep = 0;
0052 <span class="keyword">try</span> sep = img(1).show_slices.sep;
0053 <span class="keyword">end</span>
0054 
0055 
0056 <span class="comment">% TODO: because we wanted (back in 2005) to let show_slices</span>
0057 <span class="comment">% handle lots of different scenarios (calling with images and</span>
0058 <span class="comment">% without. It is now crufty ... and should be changed.</span>
0059 do_calc_slices = 0;
0060 <span class="keyword">if</span> isstruct(img)
0061    <span class="keyword">if</span> strcmp(img(1).type,<span class="string">'image'</span>);
0062       do_calc_slices= 1;
0063    <span class="keyword">else</span>
0064       error(<span class="string">'show_slices only works with type image'</span>);
0065    <span class="keyword">end</span>;
0066 <span class="keyword">end</span>
0067 
0068 <span class="keyword">if</span> nargin&lt;=1;
0069    <span class="keyword">try</span>   
0070        levels = img(1).show_slices.levels;
0071    <span class="keyword">catch</span>
0072        levels = [];
0073    <span class="keyword">end</span>
0074 <span class="keyword">end</span>
0075 
0076 <span class="comment">% Levels are set in calc_slices for 2D models. -- removed 2024-09-27 AA</span>
0077 <span class="comment">%if isempty(levels) &amp;&amp; do_calc_slices %&amp;&amp; size(img(1).fwd_model.nodes,2)==2</span>
0078 <span class="comment">%   levels= [Inf,Inf,0];</span>
0079 <span class="comment">%end</span>
0080 
0081 <span class="keyword">if</span> nargin &lt; 3
0082     vh = [];
0083 <span class="keyword">end</span>
0084 <span class="keyword">if</span> isempty(vh) &amp;&amp; isnumeric(levels) &amp;&amp; size(levels,2) == 5
0085    vh = levels(:,4:5);
0086    levels = levels(:,1:3);
0087    warning(<span class="string">'EIDORS:DeprecatedInterface'</span>, <span class="keyword">...</span>
0088     <span class="string">'Specifing 5-element level is deprecated and will cause an error in a future release.'</span>);
0089 <span class="keyword">end</span>
0090 
0091 <span class="keyword">if</span> do_calc_slices
0092    rimg= <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>( img, levels );
0093 <span class="keyword">else</span>
0094    rimg= img;
0095    <span class="keyword">if</span> isstruct(levels)
0096        img = levels;
0097        levels = [];
0098    <span class="keyword">end</span>
0099 <span class="keyword">end</span>
0100 <span class="comment">% Eventualy we need to add a filter control to do this -aa'19</span>
0101 <span class="comment">%% This is replaced with calc_slices.filter</span>
0102 <span class="comment">%if 0</span>
0103 <span class="comment">%   filt = ones(5);</span>
0104 <span class="comment">%    filt = conv2(filt,filt);</span>
0105 <span class="comment">%   rnimg = rimg;</span>
0106 <span class="comment">%   rimg(isnan(rimg)) = 0;</span>
0107 <span class="comment">%   rimg = conv2(rimg, filt,'same') / sum(filt(:));</span>
0108 <span class="comment">%   rimg(isnan(rnimg)) = NaN;</span>
0109 <span class="comment">%end</span>
0110 
0111 n_col = 0;
0112 <span class="keyword">try</span>  n_col = img(1).show_slices.img_cols;
0113 <span class="keyword">end</span>
0114 
0115 r_img = <a href="mk_mosaic.html" class="code" title="function r_img = mk_mosaic(rimg, sep, vh, n_col)">mk_mosaic</a>(rimg, sep, vh, n_col);
0116 
0117 c_img = <a href="calc_colours.html" class="code" title="function [colours,scl_data]= calc_colours(img, set_value, do_colourbar)">calc_colours</a>( r_img, img);
0118 out_img= reshape(c_img, size(r_img,1), size(r_img,2) ,[]);
0119 
0120 
0121 axes_msm = false;
0122 pts = [];
0123 <span class="keyword">try</span> axes_msm = img.show_slices.axes_msm; <span class="keyword">end</span>
0124 <span class="keyword">try</span> pts = <a href="mdl_slice_mapper.html" class="code" title="function map = mdl_slice_mapper( fmdl, maptype )">mdl_slice_mapper</a>(img.fwd_model,<span class="string">'get_points'</span>); <span class="keyword">end</span> 
0125 
0126 <span class="keyword">if</span> axes_msm &amp;&amp; size(rimg,3)==1 &amp;&amp; ~isempty(pts)
0127    msm.x_pts = pts{1}; msm.y_pts = pts{2};
0128    image(msm.x_pts, msm.y_pts, out_img);
0129    set(gca,<span class="string">'Ydir'</span>,<span class="string">'normal'</span>);
0130 <span class="keyword">else</span>
0131    image(out_img);
0132    axis image
0133 <span class="keyword">end</span>
0134 axis off
0135 axis equal
0136 axis tight
0137 
0138 do_colourbar = false;
0139 <span class="keyword">try</span> do_colourbar = img.show_slices.do_colourbar; <span class="keyword">end</span>
0140 <span class="keyword">if</span> do_colourbar
0141     <a href="calc_colours.html" class="code" title="function [colours,scl_data]= calc_colours(img, set_value, do_colourbar)">calc_colours</a>( r_img, img, 1);
0142 <span class="keyword">end</span>
0143 
0144 <span class="comment">% Do a contour plot?</span>
0145 <span class="keyword">if</span> isfield(img(1),<span class="string">'show_slices'</span>) &amp;&amp; isfield(img(1).show_slices,<span class="string">'contour_levels'</span>);
0146    clevs = img.show_slices.contour_levels;
0147    <span class="keyword">if</span> isfield(img.show_slices,<span class="string">'contour_properties'</span>);
0148       contour_properties = img.show_slices.contour_properties;
0149    <span class="keyword">else</span>
0150       contour_properties = {<span class="string">'Color'</span>,[0.2,0.2,0.3]};
0151    <span class="keyword">end</span>
0152 
0153    <span class="keyword">if</span> ~axes_msm;
0154       msm.x_pts = 1:size(rimg,2);
0155       msm.y_pts = 1:size(rimg,1);
0156    <span class="keyword">end</span>
0157    ish= ishold;
0158    <span class="keyword">if</span> isnumeric(clevs)
0159       <span class="keyword">if</span> ~ish; hold on; <span class="keyword">end</span> 
0160       contour(msm.x_pts, msm.y_pts, rimg, clevs, contour_properties{:});
0161       <span class="keyword">if</span> ~ish; hold off; <span class="keyword">end</span> 
0162    <span class="keyword">elseif</span> clevs <span class="comment">% true but not numeric</span>
0163       <span class="keyword">if</span> ~ish; hold on; <span class="keyword">end</span> 
0164       <span class="keyword">if</span> exist(<span class="string">'OCTAVE_VERSION'</span>);
0165       <span class="comment">% Octave contour doesn't accept props</span>
0166          contour(msm.x_pts, msm.y_pts, rimg);
0167       <span class="keyword">else</span>
0168          contour(msm.x_pts, msm.y_pts, rimg, contour_properties{:});
0169       <span class="keyword">end</span>
0170       <span class="keyword">if</span> ~ish; hold off; <span class="keyword">end</span> 
0171    <span class="keyword">else</span>
0172       error(<span class="string">'img.show_slices.contour_levels parameter not understood'</span>);
0173    <span class="keyword">end</span>
0174 <span class="keyword">end</span>
0175 
0176 <span class="keyword">if</span> nargout==0; clear(<span class="string">'out_img'</span>); <span class="keyword">end</span>
0177 
0178 <a name="_sub1" href="#_subfunctions" class="code">function do_unit_test</a>
0179    clf; sp=0;
0180    <span class="comment">%1</span>
0181    img=<a href="../../../eidors/solvers/calc_jacobian_bkgnd.html" class="code" title="function img_bkgnd = calc_jacobian_bkgnd( inv_model )">calc_jacobian_bkgnd</a>(<a href="../../../eidors/models/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>(<span class="string">'a2t3'</span>,8)); 
0182    img.elem_data=toeplitz(1:size(img.fwd_model.elems,1),1);
0183    sp=sp+1;subplot(4,5,sp); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>(img) 
0184    <span class="comment">%2</span>
0185    img.calc_colours.npoints= 128;
0186    sp=sp+1;subplot(4,5,sp); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>(img) 
0187    <span class="comment">%3</span>
0188    img.calc_colours.npoints= 32;
0189    img.elem_data=toeplitz(1:size(img.fwd_model.elems,1),1:3);
0190    sp=sp+1;subplot(4,5,sp); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>(img) 
0191 
0192    <span class="comment">%4</span>
0193    img.show_slices.img_cols= 1;
0194    sp=sp+1;subplot(4,5,sp); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>(img) 
0195 
0196    <span class="comment">%5</span>
0197    imgn = rmfield(img,<span class="string">'elem_data'</span>);
0198    imgn.node_data=toeplitz(1:size(img.fwd_model.nodes,1),1);
0199 
0200    img.elem_data = img.elem_data(:,1);
0201    img.fwd_model.mdl_slice_mapper.npx = 10;
0202    img.fwd_model.mdl_slice_mapper.npy = 20;
0203    img.fwd_model.mdl_slice_mapper.level = [inf,inf,0];
0204    sp=sp+1;subplot(4,5,sp); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>(img);
0205 
0206    <span class="comment">%6</span>
0207    img.elem_data = img.elem_data(:,1);
0208    img.fwd_model.mdl_slice_mapper = rmfield(img.fwd_model.mdl_slice_mapper, {<span class="string">'npx'</span>,<span class="string">'npy'</span>});
0209    img.fwd_model.mdl_slice_mapper.x_pts = linspace(-100,100,20);
0210    img.fwd_model.mdl_slice_mapper.y_pts = linspace(-150,150,30);
0211    img.fwd_model.mdl_slice_mapper.level = [inf,inf,0];
0212    sp=sp+1;subplot(4,5,sp); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>(img);
0213 
0214    <span class="comment">%7</span>
0215    sp=sp+1;subplot(4,5,sp); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>(imgn) 
0216 
0217    <span class="comment">%8</span>
0218    imgn.fwd_model.mdl_slice_mapper.x_pts = linspace(-100,100,20);
0219    imgn.fwd_model.mdl_slice_mapper.y_pts = linspace(-150,150,30);
0220    imgn.fwd_model.mdl_slice_mapper.level = [inf,inf,0];
0221    sp=sp+1;subplot(4,5,sp); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>(imgn) 
0222 
0223 
0224 <span class="comment">% 3D images</span>
0225    <span class="comment">%9</span>
0226    img=<a href="../../../eidors/solvers/calc_jacobian_bkgnd.html" class="code" title="function img_bkgnd = calc_jacobian_bkgnd( inv_model )">calc_jacobian_bkgnd</a>(<a href="../../../eidors/models/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>(<span class="string">'n3r2'</span>,[16,2])); 
0227    img.calc_colours.npoints= 16;
0228    img.elem_data=toeplitz(1:size(img.fwd_model.elems,1),1);
0229    sp=sp+1;subplot(4,5,sp); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>(img,2) 
0230 
0231    <span class="comment">%10</span>
0232    img.elem_data=img.elem_data*[1:3];
0233    sp=sp+1;subplot(4,5,sp); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>(img,2) 
0234 
0235    <span class="comment">%11</span>
0236    img.elem_data=img.elem_data(:,1:2);
0237    sp=sp+1;subplot(4,5,sp); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>(img,[inf,inf,1;0,inf,inf;0,1,inf]);
0238 
0239    <span class="comment">%12</span>
0240    img.show_slices.sep = 5;
0241    img.fwd_model.mdl_slice_mapper.x_pts = linspace(-1,1,20);
0242    img.fwd_model.mdl_slice_mapper.y_pts = linspace(-1,1,30);
0243    img.fwd_model.mdl_slice_mapper.level = [inf,inf,0];
0244 
0245    sp=sp+1;subplot(4,5,sp); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>(img,2) 
0246 
0247    <span class="comment">%13</span>
0248    img.fwd_model = rmfield(img.fwd_model, <span class="string">'mdl_slice_mapper'</span>);
0249    img.elem_data = img.elem_data(:,1);
0250    levels=[inf,inf,1,1,1;
0251            0,inf,inf,2,1;
0252            0,1,inf,3,1];
0253    sp=sp+1;subplot(4,5,sp); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>(img,levels) 
0254 
0255    <span class="comment">%14</span>
0256    levels=[inf,inf,1,1,1;
0257            0,inf,inf,2,2;
0258            0,1,inf,  1,3];
0259    sp=sp+1;subplot(4,5,sp); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>(img,levels) 
0260 
0261    <span class="comment">%15</span>
0262    img.elem_data = img.elem_data * [1,2];
0263    levels=[inf,inf,1,1,1;
0264            0,inf,inf,2,1;
0265            0,1,inf,  3,1];
0266    sp=sp+1;subplot(4,5,sp); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>(img,levels) 
0267    
0268    <span class="comment">%16</span>
0269    sp=sp+1;subplot(4,5,sp); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>(img,levels(:,1:3),levels(:,4:5)) 
0270    
0271    <span class="comment">%17</span>
0272    m = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(img,levels(:,1:3));
0273    sp=sp+1;subplot(4,5,sp); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>(m) 
0274    
0275    <span class="comment">%18</span>
0276    img.elem_data = img.elem_data(:,1);
0277    img.show_slices.contour_levels = true;
0278    sp=sp+1;subplot(4,5,sp); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>(img) 
0279 
0280    <span class="comment">%19</span>
0281    img.fwd_model.mdl_slice_mapper = struct(<span class="string">'level'</span>,[inf,inf,1], <span class="keyword">...</span>
0282      <span class="string">'x_pts'</span>, linspace(-1,1,50), <span class="string">'y_pts'</span>,linspace(-2,2,100));
0283    img.show_slices.axes_msm = true;
0284    img.show_slices.contour_properties = {<span class="string">'LineWidth'</span>,2};
0285    img.show_slices.contour_levels = 1:300;
0286    sp=sp+1;subplot(4,5,sp); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>(img) 
0287 
0288    <span class="comment">%20</span>
0289    l48 = linspace(0.5,48.5,24+1); 
0290    l32 =-linspace(0.5,32.5,16+1) + 20; 
0291    rmfn = @(xyz) vecnorm(xyz,2,2)&gt;40;
0292    fmdl = <a href="../../../eidors/models/mk_grid_model.html" class="code" title="function [cmdl, c2f]= mk_grid_model(fmdl, xvec, yvec, zvec, removefn);">mk_grid_model</a>([],l48,l32,l48,rmfn);
0293    xyz = <a href="../../../eidors/models/interp_mesh.html" class="code" title="function mdl_pts = interp_mesh( mdl, n_interp)">interp_mesh</a>(fmdl); 
0294    img = <a href="../../../eidors/models/mk_image.html" class="code" title="function img= mk_image(mdl, elem_data, params, name)">mk_image</a>(fmdl, sum(xyz,2));
0295    sp=sp+1;subplot(4,5,sp); <a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>(img,3)</pre></div>
<hr><address>Generated on Sun 29-Dec-2024 19:54:43 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>